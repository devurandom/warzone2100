#!/bin/sh

source __BUILD_CONFIG

DEBUGFLAG="--disable-debug"

for i in $*; do
	if [[ "x$i" = "xdebug" ]] ; then
		DEBUGFLAG="--enable-debug"
	elif [[ "x$i" = "xdebug-relaxed" ]] ; then
		DEBUGFLAG="--enable-debug=relaxed"
	elif [[ "x$i" = "xinstaller" ]] ; then
		CONF_EXTRA_FLAGS="${CONF_EXTRA_FLAGS}
			--enable-data --enable-installer --with-installer-extdir=\"${PREFIX}\"
			--with-installer-version=${INSTALLER_VERSION}"
	elif [[ "x$i" = "xzlib" ]] ; then
		CONF_EXTRA_FLAGS="${CONF_EXTRA_FLAGS}
			--with-nsis-compression=zlib"
	elif [[ "x$i" = "xbzip2" ]] ; then
		CONF_EXTRA_FLAGS="${CONF_EXTRA_FLAGS}
			--with-nsis-compression=bzip2"
	fi
done

CONF_EXTRA_FLAGS="${CONF_EXTRA_FLAGS}
	${DEBUGFLAG}"

# Move to the root directory
cd ..

./autogen.sh || exit 1
./configure --target=${CROSSCOMPILETARGET} --host=${CROSSCOMPILETARGET} --enable-static --disable-shared \
    --prefix="${PREFIX}" \
	${CONF_EXTRA_FLAGS} \
    CFLAGS="${CFLAGS}" \
    CPPFLAGS="${CPPFLAGS}" \
    LDFLAGS="${LDFLAGS}" \
    CC_FOR_BUILD="gcc" \
    CXX_FOR_BUILD="g++" \
    CPPFLAGS_FOR_BUILD=" " \
    PKGCONFIG_PREFIX="${PREFIX}" || exit 1
make -j3 || exit 1
